<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gensyn Identity Protocol</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=VT323&display=swap" rel="stylesheet">

    <style>
        body { background-color: #0a0a0a; font-family: 'Space Mono', monospace; overflow-x: hidden; }
        
        /* CUSTOM UI ELEMENTS */
        .cyber-panel {
            background-color: rgba(35, 8, 0, 0.95); /* #230800 with transparency */
            border: 2px solid #fad7d1;
            box-shadow: 0 0 20px rgba(250, 215, 209, 0.15);
            backdrop-filter: blur(5px);
        }
        
        .cyber-header {
            background-color: #fad7d1;
            color: #230800;
            font-family: 'VT323', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 1.25rem;
            padding: 4px 12px;
            border-bottom: 2px solid #fad7d1;
        }

        /* CUSTOM RANGE SLIDER */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            background: #fad7d1;
            margin-top: -6px;
            border-radius: 0;
            cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #333;
            border: 1px solid #555;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            // --- STATE ---
            const [imageSrc, setImageSrc] = useState(null);
            const [logoUrl, setLogoUrl] = useState(null);
            
            // UI Toggles
            const [showControls, setShowControls] = useState(true);

            // Params
            const [glitchIntensity, setGlitchIntensity] = useState(20);
            const [noiseIntensity, setNoiseIntensity] = useState(15);
            const [ditherType, setDitherType] = useState('threshold');
            const [logoSize, setLogoSize] = useState(25);
            const [logoOpacity, setLogoOpacity] = useState(100);

            const canvasRef = useRef(null);
            
            // --- LOGO LINKS ---
            const PRESETS = {
                white: "https://i.postimg.cc/QNcnw0Zd/Gensyn-Logo-Inline-White.png", 
                brown: "https://i.postimg.cc/DZxb0PFt/Gensyn-Logo-Inline-Brown.png", 
                pink:  "https://i.postimg.cc/DZp8nfdx/Gensyn-Logo-Inline-Pink.png" 
            };

            // --- INITIAL LOAD ---
            useEffect(() => {
                const img = new Image();
                img.src = 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070&auto=format&fit=crop';
                img.crossOrigin = "Anonymous";
                img.onload = () => setImageSrc(img);
            }, []);

            // --- RENDER ENGINE ---
            useEffect(() => {
                renderCanvas();
            }, [imageSrc, logoUrl, glitchIntensity, noiseIntensity, ditherType, logoSize, logoOpacity]);

            const renderCanvas = () => {
                const canvas = canvasRef.current;
                if (!canvas || !imageSrc) return;
                const ctx = canvas.getContext('2d');

                // 1. Setup
                canvas.width = imageSrc.width;
                canvas.height = imageSrc.height;
                const w = canvas.width;
                const h = canvas.height;

                // 2. Base Layer
                ctx.clearRect(0, 0, w, h);
                ctx.drawImage(imageSrc, 0, 0, w, h);

                // 3. Glitch
                if (glitchIntensity > 0) {
                    const slices = Math.floor(glitchIntensity / 2);
                    const maxOffset = w * (glitchIntensity / 100) * 0.1;
                    for (let i = 0; i < slices; i++) {
                        const sy = Math.random() * h;
                        const sh = Math.random() * (h * 0.1);
                        const dx = (Math.random() - 0.5) * maxOffset;
                        ctx.drawImage(canvas, 0, sy, w, sh, dx, sy, w, sh);
                    }
                }

                // 4. Noise & Dither Prep
                const imageData = ctx.getImageData(0, 0, w, h);
                const data = imageData.data;

                // 5. Noise
                if (noiseIntensity > 0) {
                    const factor = noiseIntensity * 2.55;
                    for (let i = 0; i < data.length; i += 4) {
                        const random = (0.5 - Math.random()) * factor;
                        data[i] += random; data[i+1] += random; data[i+2] += random;
                    }
                }

                // 6. Dither
                if (ditherType === 'threshold') {
                    for (let i = 0; i < data.length; i += 4) {
                        const avg = (data[i] + data[i+1] + data[i+2]) / 3;
                        const val = avg > 128 ? 255 : 0;
                        data[i] = data[i+1] = data[i+2] = val;
                    }
                }
                ctx.putImageData(imageData, 0, 0);

                // 7. Logo Overlay
                if (logoUrl) {
                    const logo = new Image();
                    logo.crossOrigin = "Anonymous";
                    logo.src = logoUrl;
                    if (logo.complete) {
                        ctx.globalAlpha = logoOpacity / 100;
                        const logoW = w * (logoSize / 100);
                        const logoH = logoW * (logo.height / logo.width);
                        const padding = w * 0.05;
                        ctx.drawImage(logo, w - logoW - padding, h - logoH - padding, logoW, logoH);
                        ctx.globalAlpha = 1.0;
                    } else {
                        logo.onload = () => renderCanvas();
                    }
                }
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => setImageSrc(img);
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const downloadImage = () => {
                const link = document.createElement('a');
                link.download = 'gensyn_identity.png';
                link.href = canvasRef.current.toDataURL('image/png');
                link.click();
            };

            return (
                <div className="relative min-h-screen bg-black flex flex-col md:block">
                    
                    {/* CANVAS CONTAINER */}
                    <div className="w-full h-[60vh] md:h-screen flex items-center justify-center overflow-hidden">
                        <canvas ref={canvasRef} className="max-w-full max-h-full object-contain" />
                    </div>

                    {/* FLOATING CONTROL PANEL */}
                    <div className="md:fixed md:top-8 md:right-8 w-full md:w-[380px] z-50 p-4 md:p-0">
                        <div className="cyber-panel flex flex-col">
                            
                            {/* HEADER */}
                            <div className="cyber-header flex justify-between items-center cursor-pointer" onClick={() => setShowControls(!showControls)}>
                                <span>/// CONTROL_PANEL</span>
                                <span>{showControls ? '[-]' : '[+]'}</span>
                            </div>

                            {/* CONTROLS BODY */}
                            {showControls && (
                                <div className="p-6 flex flex-col gap-6">
                                    
                                    {/* SECTION: BRANDING */}
                                    <div className="flex flex-col gap-3">
                                        <div className="text-[#fad7d1] text-[10px] font-bold tracking-[0.2em] border-b border-[#331100] pb-1">IDENTITY_SOURCE</div>
                                        
                                        <div className="grid grid-cols-3 gap-2">
                                            <button onClick={() => setLogoUrl(PRESETS.white)} className={`h-10 border ${logoUrl === PRESETS.white ? 'bg-[#fad7d1] text-black' : 'border-[#fad7d1] text-[#fad7d1]'} text-xs font-bold hover:bg-[#fad7d1] hover:text-black`}>WHT</button>
                                            <button onClick={() => setLogoUrl(PRESETS.black)} className={`h-10 border ${logoUrl === PRESETS.black ? 'bg-[#fad7d1] text-black' : 'border-[#fad7d1] text-[#fad7d1]'} text-xs font-bold hover:bg-[#fad7d1] hover:text-black`}>BLK</button>
                                            <button onClick={() => setLogoUrl(PRESETS.pink)}  className={`h-10 border ${logoUrl === PRESETS.pink ? 'bg-[#fad7d1] text-black' : 'border-[#fad7d1] text-[#fad7d1]'} text-xs font-bold hover:bg-[#fad7d1] hover:text-black`}>PNK</button>
                                        </div>

                                        <div className="relative group">
                                            <input type="file" onChange={handleImageUpload} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                                            <div className="w-full py-2 border border-dashed border-[#555] text-gray-400 text-xs text-center group-hover:border-[#fad7d1] group-hover:text-[#fad7d1]">
                                                [ CLICK TO UPLOAD IMAGE ]
                                            </div>
                                        </div>
                                    </div>

                                    {/* SECTION: GLITCH */}
                                    <div className="flex flex-col gap-4">
                                        <div className="text-[#fad7d1] text-[10px] font-bold tracking-[0.2em] border-b border-[#331100] pb-1">SIGNAL_MODULATION</div>
                                        
                                        <div className="space-y-1">
                                            <div className="flex justify-between text-[#fad7d1] text-xs"><span>GLITCH</span> <span>{glitchIntensity}%</span></div>
                                            <input type="range" min="0" max="100" value={glitchIntensity} onChange={(e) => setGlitchIntensity(parseInt(e.target.value))} className="w-full" />
                                        </div>

                                        <div className="space-y-1">
                                            <div className="flex justify-between text-[#fad7d1] text-xs"><span>NOISE</span> <span>{noiseIntensity}%</span></div>
                                            <input type="range" min="0" max="100" value={noiseIntensity} onChange={(e) => setNoiseIntensity(parseInt(e.target.value))} className="w-full" />
                                        </div>

                                        <div className="space-y-1">
                                            <div className="flex justify-between text-[#fad7d1] text-xs"><span>LOGO_SIZE</span> <span>{logoSize}%</span></div>
                                            <input type="range" min="5" max="50" value={logoSize} onChange={(e) => setLogoSize(parseInt(e.target.value))} className="w-full" />
                                        </div>
                                        
                                        <div className="space-y-1">
                                            <div className="flex justify-between text-[#fad7d1] text-xs"><span>LOGO_OPACITY</span> <span>{logoOpacity}%</span></div>
                                            <input type="range" min="0" max="100" value={logoOpacity} onChange={(e) => setLogoOpacity(parseInt(e.target.value))} className="w-full" />
                                        </div>

                                        <label className="flex items-center gap-3 text-[#fad7d1] text-xs cursor-pointer">
                                            <input type="checkbox" checked={ditherType === 'threshold'} onChange={() => setDitherType(ditherType === 'threshold' ? 'none' : 'threshold')} className="accent-[#fad7d1]" />
                                            [ ENABLE THRESHOLD_DITHER ]
                                        </label>
                                    </div>

                                    {/* EXPORT */}
                                    <button onClick={downloadImage} className="w-full py-3 bg-[#fad7d1] text-[#230800] font-bold font-['Space_Mono'] hover:bg-white hover:scale-[1.02] transition-all">
                                        >> DOWNLOAD_IDENTITY
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>